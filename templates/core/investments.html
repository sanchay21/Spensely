{% extends 'base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'core/styles.css' %}">
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock styles %}

{% block title %}
    Investments | {{ user.username }}
{% endblock title %}

{% block content %}
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h2 class="logo">Spensely</h2>
            <nav>
                <a href="{% url 'core:dashboard' %}">Dashboard</a>
                <a href="{% url 'core:transactions' %}">Expenses</a>
                <a href="{% url 'core:investments' %}" class="active">Investments</a>
                <a href="#">Goals</a>
                <a href="#">Profile</a>
                <a href="#">Settings</a>
            </nav>
            <div class="sidebar-bottom">
                <a href="#">Help & Support</a>
                <a href="#">Logout</a>
            </div>
        </aside>

        <!-- Main -->
        <main>
            <!-- Header -->
            <header class="header">
                <input type="text" placeholder="Search transactions, categories...">
                <div class="profile">
                    <span class="notif">3</span>
                    <img src="assets/user.png" alt="Profile">
                </div>
            </header>

            <!-- Investments Section -->
            <section class="investments-section">
                <div class="section-header">
                    <h1>Investments</h1>
                    <div>
                        <button class="btn-primary">+ Add Investment</button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="card">
                        <h4>Total Invested</h4>
                        <p class="amount">₹{{ total_invested }}</p>
                    </div>
                    <div class="card">
                        <h4>Current Value</h4>
                        <p class="amount">₹{{ total_current }}</p>
                    </div>
                    <div class="card">
                        <h4>Total Returns</h4>
                        <p class="amount green">₹{{ total_returns }} <span class="percent"> +{{ total_return_pct }}%</span></p>
                    </div>
                </div>

                <!-- Chart + Portfolio side by side -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                    
                    <!-- Pie/Donut Chart -->
                    <div class="table-card">
                        <h3>Asset Distribution</h3>
                        <canvas id="distributionChart"></canvas>
                    </div>

                    <!-- Portfolio Table -->
                    <div class="table-card">
                        <h3>Your Portfolio</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Asset</th>
                                    <th>Invested</th>
                                    <th>Current Value</th>
                                    <th>Returns</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for inv in investments %}
                                <tr>
                                    <td>{{ inv.symbol }}</td>
                                    <td>₹{{ inv.invested }}</td>
                                    <td>₹{{ inv.current_value }}</td>
                                    <td>{{ inv.returns }}%</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button class="btn-secondary small">View All</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Chart.js Script -->
    <script>
        const ctx = document.getElementById('distributionChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Gold', 'Stocks', 'Crypto'],
                datasets: [{
                    data: [300500, 200000, 100000], // Hardcoded values
                    backgroundColor: ['#FFD700', '#36A2EB', '#FF6384'],
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                animation: {
                    duration: 1900   // <-- 2 seconds animation
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ₹${context.raw.toLocaleString()}`;
                            }
                        }
                    }
                }
            }
        });
    </script>
{% endblock content %}
